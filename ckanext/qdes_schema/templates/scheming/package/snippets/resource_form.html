{% extends 'package/snippets/resource_form.html' %}

{% block errors %}
  {%- if errors -%}
    {%- set schema = h.scheming_get_dataset_schema(dataset_type) -%}
    {%- snippet 'scheming/snippets/errors.html',
      errors=errors, fields=schema.resource_fields,
      entity_type='dataset', object_type=dataset_type -%}
  {%- endif -%}
{% endblock %}

{% block basic_fields %}
  {% if g.action not in ['new'] %}
    {% set pkg_dict = h.get_package_dict(data.package_id) %}
    {% snippet "/snippets/invalid_uris_error.html", entity_id=data.id, entity=pkg_dict, parent_entity=pkg_dict.type %}
  {% endif %}

  {% if h.ckan_version() > '2.9' %}
    {% asset 'qdes_schema/repeater' %}
    {% asset 'qdes_schema/repeating-fields' %}
  {% else %}
    {% resource 'qdes_schema/jquery.repeater.js' %}
    {% resource 'qdes_schema/repeating-fields.js' %}
  {% endif %}

  {%- if not dataset_type -%}
    <p>
    dataset_type not passed to template. your version of CKAN
    might not be compatible with ckanext-scheming
    </p>
  {%- endif -%}
  {%- set schema = h.scheming_get_dataset_schema(dataset_type) -%}
  {%- for field in schema.resource_fields -%}
    {% if field.recommended %}
      {% do field.update({'classes': ['recommended-field'] }) %}
    {% endif %}

    {%- if field.form_snippet is not none -%}
      {%- snippet 'scheming/snippets/form_field.html',
        field=field, data=data, errors=errors,
	entity_type='dataset', object_type=dataset_type -%}
    {%- endif -%}
  {%- endfor -%}
{% endblock %}

{% block metadata_fields %}
{% endblock %}
