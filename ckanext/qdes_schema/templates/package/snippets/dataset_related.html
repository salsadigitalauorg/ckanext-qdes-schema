{% set relationships = h.get_all_relationships(pkg.id) %}
{% set related_datasets = [] %}
{% set related_resources = [] %}

{% for relationship in relationships %}
    {% if relationship.type == 'unspecified relationship' %}
        {% do related_datasets.append(relationship) %}
    {% else %}
        {% do related_resources.append(relationship) %}
    {% endif %}
{% endfor %}

{% macro relationship_row(data, property) %}
    {% for row in data %}
            <tr>
                <td property="{{property}}">
                    {% if row.pkg_id %}
                        <a href="{{ h.url_for('dataset_read', id=row.pkg_id) }}">{{ row.pkg_title }}</a>
                    {% else %}
                        <a href="{{ row.comment }}">{{ row.comment }}</a>
                    {% endif %}
                </td>
                <td property="dcat:hadRole">
                    {{ row.type }}
                </td>
            </tr>
    {% endfor %}
{% endmacro %}

<h3>Related dataset(s)</h3>
{% if related_datasets %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Dataset Name</th>
                <th>Nature of Relationship</th>
            </tr>
        </thead>

        {{ relationship_row(related_datasets, 'dcterms:relation') }}
    </table>
{% else %}
    <h4>This dataset has no related dataset.</h4>
{% endif %}


<h3>Related resource(s)</h3>
{% if related_resources %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Dataset Name</th>
                <th>Nature of Relationship</th>
            </tr>
        </thead>

        {{ relationship_row(related_resources, 'dcat:qualifiedRelation') }}
    </table>
{% else %}
    <h4>This dataset has no related dataset.</h4>
{% endif %}
